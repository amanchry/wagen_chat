<VirtualHost *:80>
    ServerName geochat.waterinag.org
    Redirect permanent / https://geochat.waterinag.org/
</VirtualHost>

<VirtualHost *:443>
    ServerAdmin admin@geochat.waterinag.org
    ServerName geochat.waterinag.org

    # React Frontend
    DocumentRoot /home/aman/geochat/frontend/build
    DirectoryIndex index.html

    <Directory /home/aman/geochat/frontend/build>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # React SPA Fallback (important for routes like /dashboard)
    FallbackResource /index.html

    # Proxy API calls to Django running on port 8006
    ProxyPreserveHost On
    ProxyPass /api http://127.0.0.1:8006/api
    ProxyPassReverse /api http://127.0.0.1:8006/api

    # (Optional) If you want /media and /static from Django handled by backend
    ProxyPass /media http://127.0.0.1:8006/media
    ProxyPassReverse /media http://127.0.0.1:8006/media

    ProxyPass /django_static http://127.0.0.1:8006/django_static
    ProxyPassReverse /django_static http://127.0.0.1:8006/django_static

    ErrorLog ${APACHE_LOG_DIR}/geochat_error.log
    CustomLog ${APACHE_LOG_DIR}/geochat_access.log combined
</VirtualHost>
